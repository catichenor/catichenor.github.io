<!DOCTYPE html>
<html lang="en">
<head>
		<title>EatYourAlgorithms &mdash; Day Three</title>
		<meta charset="utf-8" />
                <!--<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>-->
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
		<link rel='stylesheet' id='oswald-css'  href='//fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2' type='text/css' media='all' />
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/atom+xml"
			title="EatYourAlgorithms — Flux Atom"
			href="/" /> 
		<!--[if lte IE 8]><script src="/theme/js/html5shiv.js"></script><![endif]-->
</head>

<body class="home blog custom-background " >
	<div id="container">
		<div id="header">
				<h1 id="site-title"><a href="">EatYourAlgorithms</a></h1>
		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/category/algorithms.html">Algorithms</a></li>
						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/category/site.html">Site</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="#">If you don’t do vegetables, do your drugs, and eat your algorithms, you can be big and strong like me!</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/day-three.html">Sun 25 March 2018</a></div>
		<span class="byline">By <a href="/author/christopher-tichenor.html">Christopher Tichenor</a></span>
			<span class="cat-links"><a href="/category/algorithms.html" title="View all posts in Algorithms" rel="category tag">Algorithms</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/day-three.html" title="Permalink to Day Three" rel="bookmark">Day Three</a>
		</h2>
		<div class="entry-content">
			<p>As a follow-up from yesterday, apparently using inheritance isn’t much better for <a href="https://medium.com/@george.shuklin/why-you-cant-remove-parent-methods-in-python-d4935e6d54a4">removing methods from a parent</a>. Ah well.</p>
<p>Time to move on to working with some of the other array types. On the varying data side, I’m pretty familiar with lists and tuples, so I won’t waste time with those. On the single-data-type side I’m pretty familiar with strings too (though it’s tempting to play with the newly-discovered recursion aspect). That leaves Bytes and Bytearrays.</p>
<p>It might be a good exercise to try to <a href="https://stackoverflow.com/questions/20276458/working-with-bmp-files-in-python-3">read a BMP file again</a> as I’d attempted to do at a class preceding PyBay 2017.</p>
<hr>
<p>First off, we need to read the file:</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/Users/chris/Dropbox/Experiments/eatyouralgorithms/bmptest.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">orig_bmp</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>


<p>Here's what it looks like for reference:</p>
<p><img alt="I'm actually a trained artist. Go figure." src="/images/003_bmptest.png"></p>
<p>Now, let's decode the bytes like in the article:</p>
<div class="highlight"><pre><span></span><span class="n">orig_bmp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</pre></div>


<p>Error!</p>
<div class="highlight"><pre><span></span>    ---------------------------------------------------------------------------

    AttributeError                            Traceback (most recent call last)

    &lt;ipython-input-2-7b9b1a26efec&gt; in &lt;module&gt;()
    ----&gt; 1 orig_bmp.read(2).decode()


    AttributeError: &#39;bytes&#39; object has no attribute &#39;read&#39;
</pre></div>


<p>Oops. That doesn't work. What if I try to print the whole thing?</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">)</span>
</pre></div>


<p>And we get...</p>
<div class="highlight"><pre><span></span>    IOPub data rate exceeded.
    The notebook server will temporarily stop sending output
    to the client in order to avoid crashing it.
    To change this limit, set the config variable
    `--NotebookApp.iopub_data_rate_limit`.
</pre></div>


<p>Yes, I'm using a Jupyter Notebook for these tests, suppose I should've guessed that would happen. </p>
<p>Let's try doing exactly what the original StackOverflow article recommends against. <a href="https://en.wikipedia.org/wiki/BMP_file_format">The Wikipedia article</a> says that the first 14 bytes are the header:</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span>b&#39;BM6v/\x00\x00\x00\x00\x006\x00\x00&#39;
</pre></div>


<p>Ech. My hexadecimal sucks so this is effectively gibberish to me. What if we try printing decimals? (<em>I went through a few iterations of this before realizing where the cutoff should be.</em>)</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">60</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{}:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
</pre></div>


<p>This prints out:</p>
<div class="highlight"><pre><span></span>    0:66
    1:77
    2:54
    3:118
    4:47
    5:0
    6:0
    7:0
    8:0
    9:0
    10:54
    11:0
    12:0
    13:0
    14:40
    15:0
    16:0
    17:0
    18:56
    19:4
    20:0
    21:0
    22:48
    23:253
    24:255
    25:255
    26:1
    27:0
    28:32
    29:0
    30:0
    31:0
    32:0
    33:0
    34:0
    35:0
    36:0
    37:0
    38:19
    39:11
    40:0
    41:0
    42:19
    43:11
    44:0
    45:0
    46:0
    47:0
    48:0
    49:0
    50:0
    51:0
    52:0
    53:0
    54:255
    55:255
    56:255
    57:255
    58:255
    59:255
</pre></div>


<p>It looks like at byte 54 we start going into the image data. This also isn't telling me a whole lot more than that. Let's try the Struct module, <a href="https://stackoverflow.com/questions/47003833/how-to-read-bmp-file-header-in-python">this</a> seems to give better information on using it:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">struct</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/Users/chris/Dropbox/Experiments/eatyouralgorithms/bmptest.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Size: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Reserved 1: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Reserved 2: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Offset: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;DIB Header Size: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Width: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Height: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Colour Planes: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Bits per Pixel: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Compression Method: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Raw Image Size: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Horizontal Resolution: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Vertical Resolution: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of Colours: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Important Colours: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
</pre></div>


<p>Which results in:</p>
<div class="highlight"><pre><span></span>    Type: BM
    Size: 3110454
    Reserved 1: 0
    Reserved 2: 0
    Offset: 54
    DIB Header Size: 40
    Width: 1080
    Height: 4294966576
    Colour Planes: 1
    Bits per Pixel: 32
    Compression Method: 0
    Raw Image Size: 0
    Horizontal Resolution: 2835
    Vertical Resolution: 2835
    Number of Colours: 0
    Important Colours: 0
</pre></div>


<p>Something's going haywire when we read the "Height" metadata, but then I think the "Colour" planes is ok, and the "Bits per Pixel" looks right. How the hell the resolution is determined beats me.</p>
<p><a href="https://stackoverflow.com/questions/12464310/getting-incorrect-width-when-decoding-bitmap#12465956">StackOverflow to the rescue</a> again, looks like Acorn may have put a negative value in for the height, denoting that it's top-down rather than the typical bottom-up. Let's fix that:</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/Users/chris/Dropbox/Experiments/eatyouralgorithms/bmptest.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Size: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Reserved 1: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Reserved 2: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Offset: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;DIB Header Size: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Width: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Height: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>  <span class="c1"># &lt;- Change to signed int</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Colour Planes: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Bits per Pixel: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Compression Method: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Raw Image Size: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Horizontal Resolution: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Vertical Resolution: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of Colours: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Important Colours: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
</pre></div>


<p>And now we get:</p>
<div class="highlight"><pre><span></span>    Type: BM
    Size: 3110454
    Reserved 1: 0
    Reserved 2: 0
    Offset: 54
    DIB Header Size: 40
    Width: 1080
    Height: -720
    Colour Planes: 1
    Bits per Pixel: 32
    Compression Method: 0
    Raw Image Size: 0
    Horizontal Resolution: 2835
    Vertical Resolution: 2835
    Number of Colours: 0
    Important Colours: 0
</pre></div>


<p>That looks right now.</p>
<p>Okay so after reading all of that data, does that match up with where the image data starts? Let me extract the bytes with some regexing in Sublime Text, which yields:</p>
<div class="highlight"><pre><span></span>2 4 2 2 4 4 4 4 2 2 4 4 4 4 4 4
</pre></div>


<p>I'll calculate this in Python because that's where I'm building up my fluency:</p>
<div class="highlight"><pre><span></span><span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;2 4 2 2 4 4 4 4 2 2 4 4 4 4 4 4&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="n">x</span>
<span class="c1"># Output: 54</span>
</pre></div>


<p>Bingo. That matches with where I saw the image data starting.</p>
<p>Now that we know where the pixel data starts, let's see where the pixel data is <em>not</em> black or white:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">[</span><span class="mi">54</span><span class="p">:]):</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">255</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{}:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>...blah blah blah...
    1461672:73
    1461673:73
    1461674:73
    1461676:231
    1461677:231
    1461678:231
    1462201:233
    1462202:227
    1462205:203
    1462206:191
    1462209:173
    1462210:155
    1462213:144
    1462214:118
    1462217:115
    1462218:83
    1462221:95
    1462222:58
    1462225:84
    1462226:46
...and so on and so forth...
</pre></div>


<p>At pixel 1462201 is where things start getting interesting, at least to me. This is where the pixels are not the same in all three channels, which means these are colored pixels. Acorn, bless its heart, does not use partial pixel antialiasing, so when it antialiases a transition between black and white, all of the RGB values are increased/decreased at the same time.</p>
<p>The file metadata also indicates that the image data is 32bpp, which means we have an alpha channel. That's consistent with this data as we're seeing a 1 byte gap between the color data.</p>
<p>So, pixel 1462201 is where we should start seeing the "nose". What I'd like to do is change the color of the nose from blue to red. According to Acorn, the blue that I'm using uses 255 in the Blue channel, 4 in the Red channel, and 51 in the Green channel. I should flip that around so I'm using 255 in the Red channel, 4 in the Green channel, and 51 in the Red channel (yes, I know that color perception doesn't work that way, but the values should be "close enough" for a decent, if slightly magenta, red).</p>
<p>I iterated through this code to figure out what color is what:</p>
<div class="highlight"><pre><span></span><span class="n">mbmp</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">[</span><span class="mi">54</span><span class="p">:])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mbmp</span><span class="p">),</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mbmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">mbmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mbmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">mbmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Green: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mbmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Red: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mbmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Blue: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mbmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>


<p>Which results in:</p>
<div class="highlight"><pre><span></span>...blah blah blah...
    Blue: 255
    Green: 51
    Red: 4
    Blue: 255
    Green: 51
    Red: 4
    Blue: 255
    Green: 51
    Red: 4
...blah blah blah...
</pre></div>


<p>Now let's put it all together:</p>
<div class="highlight"><pre><span></span><span class="n">output_bytes</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">output_bytes</span><span class="p">),</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]:</span>
        <span class="n">green</span> <span class="o">=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">red</span> <span class="o">=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">blue</span> <span class="o">=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">red</span>
        <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">blue</span>
        <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">green</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;out.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_bytes</span><span class="p">)</span>
</pre></div>


<p><img alt="That nose is not what I expected." src="/images/003_out_magenta.png"></p>
<p>It works! Okay, more magenta than I would've liked, but still, I edited the raw bytes of an image!</p>
<p>Upon further inspection it looks like I'm not actually modifying the blue value, both blue and red are at 255, which explains the magenta-ness.</p>
<p>Let's rework the color channels again:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">),</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">orig_bmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">orig_bmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Green: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Red: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Blue: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>


<p>And now we have:</p>
<div class="highlight"><pre><span></span>...blah blah blah...
    Green: 51
    Red: 4
    Blue: 255
    Green: 51
    Red: 4
    Blue: 255
    Green: 51
    Red: 4
    Blue: 255
    Green: 51
    Red: 4
    Blue: 255
...blah blah blah...
</pre></div>


<p>Messing around with this code has showed me that I mixed up the alpha with the blue channel, now to fix:</p>
<div class="highlight"><pre><span></span><span class="n">output_bytes</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">orig_bmp</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">output_bytes</span><span class="p">),</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]:</span>
        <span class="n">blue</span> <span class="o">=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">green</span> <span class="o">=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">red</span> <span class="o">=</span> <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">red</span>
        <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">green</span>
        <span class="n">output_bytes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">blue</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;out.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_bytes</span><span class="p">)</span>
</pre></div>


<p><img alt="That nose isn't cold anymore!" src="/images/003_out.png"></p>
<p>And it actually works (for real this time)!</p>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/algorithms.html" rel="tag">algorithms</a>,  <a href="/tag/byte.html" rel="tag">byte</a>,  <a href="/tag/bytearray.html" rel="tag">bytearray</a>,  <a href="/tag/howto.html" rel="tag">howto</a>,  <a href="/tag/programming.html" rel="tag">programming</a>,  <a href="/tag/python.html" rel="tag">python</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post-->

		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://getpelican.com">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>